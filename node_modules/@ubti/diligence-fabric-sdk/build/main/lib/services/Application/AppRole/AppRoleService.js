"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ApplicationRoleService = void 0;
const config_1 = require("../../../../config");
const Request_1 = require("../../../../core/Request");
const LoggerService_1 = require("../../Logger/LoggerService");
// eslint-disable-next-line functional/no-class
class ApplicationRoleService {
    constructor(appId, tenantId, appEnvironmentCODE) {
        this.tenantId = tenantId;
        this.appId = appId;
        this.appEnvironmentCODE = appEnvironmentCODE;
    }
    setUserToken(token) {
        this.headers = { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` };
        const decodedData = JSON.parse(atob(token.split('.')[1]));
        this.userId = parseInt(decodedData === null || decodedData === void 0 ? void 0 : decodedData.userId, 0);
        this.tenantId = parseInt(decodedData === null || decodedData === void 0 ? void 0 : decodedData.TenantID, 0);
    }
    async getUserAppRole(requestBody, mode = 'ALL') {
        const url = config_1.SdkConfig.ServiceConfig.UserAppRoleService.GETALL;
        requestBody.tenantID = this.tenantId;
        requestBody.calledBy = this.userId;
        requestBody.appID = this.appId;
        requestBody.appEnvironmentCODE = this.appEnvironmentCODE;
        const response = await (0, Request_1.request)(config_1.SdkConfig, {
            method: 'POST',
            url: url,
            body: requestBody,
            mediaType: 'application/json',
            headers: this.headers
        });
        if (mode !== 'ALL') {
            response.Result = response.Result.filter(x => x.UserID == this.userId);
        }
        return response;
    }
    async getAppRole(requestBody) {
        const url = config_1.SdkConfig.ServiceConfig.UserAppRoleService.GETALL;
        requestBody.tenantID = this.tenantId;
        requestBody.calledBy = this.userId;
        requestBody.appID = this.appId;
        const response = await (0, Request_1.request)(config_1.SdkConfig, {
            method: 'POST',
            url: url,
            body: requestBody,
            mediaType: 'application/json',
            headers: this.headers
        });
        return response;
    }
    getAppMenuAppRole(requestBody) {
        const url = config_1.SdkConfig.ServiceConfig.AppMenuAppRoleService.GET;
        requestBody.tenantID = this.tenantId;
        requestBody.calledBy = this.userId;
        requestBody.appID = this.appId;
        requestBody.appEnvironmentCODE = this.appEnvironmentCODE;
        return (0, Request_1.request)(config_1.SdkConfig, {
            method: 'POST',
            url: url,
            body: requestBody,
            mediaType: 'application/json',
            headers: this.headers
        });
    }
    get(requestBody) {
        const url = requestBody.AppID ? config_1.SdkConfig.ServiceConfig.ApplicationService.GET : config_1.SdkConfig.ServiceConfig.ApplicationService.GETALL;
        requestBody.TenantID = this.tenantId;
        requestBody.CalledBy = this.userId;
        return (0, Request_1.request)(config_1.SdkConfig, {
            method: 'POST',
            url: url,
            body: requestBody,
            mediaType: 'application/json',
            headers: this.headers
        });
    }
    async getAllAccessibleMenus(useNewFormat = false) {
        var _a;
        let finalAppMenuResponse = [], appMenus = [];
        const requestBody = {
            tenantID: this.tenantId,
            calledBy: this.userId,
            appID: this.appId,
            appEnvironmentCODE: this.appEnvironmentCODE
        };
        const userRoleList = await this.getUserAppRole(requestBody);
        LoggerService_1.LoggerService.Logger.info("User Role List Response " + userRoleList);
        const filteredResults = userRoleList.Result.filter((x) => x.UserID === this.userId);
        try {
            if (filteredResults.length === 0) {
                throw "User doesn't have any Application Roles associated. Please contact Tenant Admin.";
            }
            const userAppRoleData = JSON.parse((_a = filteredResults[0]) === null || _a === void 0 ? void 0 : _a.AppRoles).map(res => res.AppRoleID);
            const appMenuAppRoleRequest = {
                tenantID: this.tenantId,
                calledBy: this.userId,
                appID: this.appId,
                appEnvironmentCODE: this.appEnvironmentCODE
            };
            const appmenuAppRoleResponse = await this.getAppMenuAppRole(appMenuAppRoleRequest);
            const appmenuAppRoleList = appmenuAppRoleResponse.Result;
            for (let i = 0; i < appmenuAppRoleList.length; i++) {
                const data = JSON.parse(appmenuAppRoleList[i].AppRoles);
                const appMenuRole = data.map(x => x.AppRoleID);
                if (appMenuRole.filter((x) => userAppRoleData.includes(x)).length !== 0) {
                    finalAppMenuResponse.push(appmenuAppRoleList[i]);
                }
            }
            if (!useNewFormat) {
                appMenus = finalAppMenuResponse.map(x => ({
                    AppMenuID: x.AppMenuID,
                    AppMenuLabel: x.AppMenuLabel,
                    ParenAppMenuID: x.ParentAppMenuID,
                    AppMenuActionURL: x.AppMenuActionURL,
                    childMenus: []
                }));
                const childMenus = appMenus.filter(res => res.ParenAppMenuID != 0).map(x => ({
                    AppMenuID: x.AppMenuID,
                    AppMenuLabel: x.AppMenuLabel,
                    ParentAppMenuID: x.ParenAppMenuID,
                    AppMenuActionURL: x.AppMenuActionURL,
                    child_Menus: []
                }));
                const child_Menus = childMenus.filter(res => res.ParentAppMenuID != 0).map(x => ({
                    AppMenuID: x.AppMenuID,
                    AppMenuLabel: x.AppMenuLabel,
                    ParentAppMenuID: x.ParentAppMenuID,
                    AppMenuActionURL: x.AppMenuActionURL
                }));
                for (let k = 0; k < appMenus.length; k++) {
                    const tempData = childMenus.filter(x => x.ParentAppMenuID == appMenus[k].AppMenuID);
                    appMenus[k].childMenus = tempData;
                    for (let j = 0; j < appMenus[k].childMenus.length; j++) {
                        const tempData1 = child_Menus.filter(x => x.ParentAppMenuID == appMenus[k].childMenus[j].AppMenuID);
                        appMenus[k].childMenus[j].child_Menus = tempData1;
                    }
                }
            }
            else {
                // New structured format (hierarchical)
                const formattedMenus = finalAppMenuResponse.map(x => ({
                    AppMenuID: x.AppMenuID,
                    AppMenuLabel: x.AppMenuLabel,
                    ParentAppMenuID: x.ParentAppMenuID,
                    AppMenuActionURL: x.AppMenuActionURL,
                    childMenus: []
                }));
                const menuMap = new Map();
                formattedMenus.forEach(menu => menuMap.set(menu.AppMenuID, menu));
                formattedMenus.forEach(menu => {
                    if (menu.ParentAppMenuID && menuMap.has(menu.ParentAppMenuID)) {
                        const parent = menuMap.get(menu.ParentAppMenuID);
                        parent.childMenus.push(menu);
                    }
                });
                appMenus = formattedMenus.filter(menu => !menu.ParentAppMenuID);
            }
            return appMenus;
        }
        catch (error) {
            LoggerService_1.LoggerService.Logger.error(error);
            return error;
        }
    }
    async isMenuAuthorized(appMenuURLPath) {
        const appRequestBody = {
            TenantID: this.tenantId,
            AppID: this.appId
        };
        const checkApp = await this.get(appRequestBody);
        const menuResult = await this.getAllAccessibleMenus();
        if (Array.isArray(menuResult)) {
            if (menuResult.length === 0) {
                return { status: 404, isAuthorized: false, empty: true, message: "No Menus were found! Please contact your Tenant Admin." };
            }
            if (Boolean(menuResult.find(x => x.AppMenuActionURL && new URL(x.AppMenuActionURL).pathname === appMenuURLPath || appMenuURLPath === '/'))) {
                return { status: 200, isAuthorized: true, empty: false, message: "Authorized" };
            }
        }
        else {
            return { status: 404, isAuthorized: false, empty: true, message: "No Menus were found! Please contact your Tenant Admin." };
        }
        return { status: 403, isAuthorized: false, empty: false, message: "Forbidden! You are not allowed to access this page." };
    }
}
exports.ApplicationRoleService = ApplicationRoleService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQXBwUm9sZVNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi9zcmMvbGliL3NlcnZpY2VzL0FwcGxpY2F0aW9uL0FwcFJvbGUvQXBwUm9sZVNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQUEsK0NBQThDO0FBRTlDLHNEQUFrRDtBQUNsRCw4REFBMkQ7QUFTM0QsK0NBQStDO0FBQy9DLE1BQWEsc0JBQXNCO0lBTy9CLFlBQVksS0FBYSxFQUFFLFFBQWdCLEVBQUUsa0JBQTBCO1FBQ25FLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFBO1FBQ2xCLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxrQkFBa0IsQ0FBQTtJQUNoRCxDQUFDO0lBRU0sWUFBWSxDQUFDLEtBQWE7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRyxFQUFFLGNBQWMsRUFBRSxrQkFBa0IsRUFBRSxlQUFlLEVBQUUsVUFBVSxLQUFLLEVBQUUsRUFBRSxDQUFBO1FBQ3pGLE1BQU0sV0FBVyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ3pELElBQUksQ0FBQyxNQUFNLEdBQUcsUUFBUSxDQUFDLFdBQVcsYUFBWCxXQUFXLHVCQUFYLFdBQVcsQ0FBRSxNQUFNLEVBQUUsQ0FBQyxDQUFDLENBQUE7UUFDOUMsSUFBSSxDQUFDLFFBQVEsR0FBRyxRQUFRLENBQUMsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLFFBQVEsRUFBRSxDQUFDLENBQUMsQ0FBQTtJQUN0RCxDQUFDO0lBRU0sS0FBSyxDQUFDLGNBQWMsQ0FBQyxXQUEyQixFQUFFLElBQUksR0FBRyxLQUFLO1FBRWpFLE1BQU0sR0FBRyxHQUFHLGtCQUFTLENBQUMsYUFB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